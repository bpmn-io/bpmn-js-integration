<html>
<head>
  <title>bpmn.js tester script</title>
  <!-- source file: '{{bpmnFile}}' -->

  <style>
    body {
      margin: 0;
    }
  </style>
</head>
<body>

  <div id="canvas"></div>
  
  <script src="{{bpmnJS}}"></script>

  <script>
    var BpmnJS = require('bpmn/Modeler');

    var xml = '{{bpmnXml}}';

    var container = document.getElementById('canvas');

    var renderer = new BpmnJS(container);

    var plan = 0;

    renderer.importXML(xml, function(err) {
      if (err) {
        console.log('import bpmn FAIL\n' + err);
        return console.log('done');
      }

      var svg = document.getElementsByTagName('svg')[0];
      var bbox = svg.getBBox();

      // scale svg to fit view port
      svg.setAttribute('viewBox', [0, 0, Math.max(1024, bbox.width + bbox.x), Math.max(768, bbox.height + bbox.y) ].join(' '));

      console.info('import bpmn SUCCESS');

      renderer.saveSVG(function(err, svg) {

        if (err) {
          return console.log('export svg FAIL\n' + err);
        }

        console.log('export svg SUCCESS\n' + svg);

        if (++plan == 2) {
          console.log('done');
        }
      });

      renderer.saveXML({ format: true }, function(err, xml) {

        if (err) {
          return console.log('export bpmn FAIL\n' + err);
        }

        console.log('export bpmn SUCCESS\n' + xml);

        if (++plan == 2) {
          console.log('done');
        }
      });
    });
  </script>
</body>
</html>