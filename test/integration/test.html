<html>
<head>
  <title>bpmn.js tester script</title>
  <!-- source file: '{{bpmnFile}}' -->

  <style>
    body {
      margin: 0;
    }
  </style>
</head>
<body>

  <div id="canvas"></div>

  <script src="{{bpmnJS}}"></script>

  <script>

    function test() {
      var BpmnJS = require('bpmn-js/Modeler');

      var xml = '{{bpmnXml}}';

      var container = document.getElementById('canvas');

      var renderer = window.renderer = new BpmnJS({ container: container, width: '100%', height: '100%' });

      var plan = 0;

      renderer.importXML(xml, function(err) {
        if (err) {
          console.log('import bpmn FAIL\n' + JSON.stringify(err));
          return console.log('done');
        }

        renderer.diagram.get('canvas').zoom('fit-viewport');

        console.info('import bpmn SUCCESS');

        renderer.saveSVG(function(err, svg) {

          if (err) {
            console.log('export svg FAIL\n' + JSON.stringify(err));
          } else {
            console.log('export svg SUCCESS\n' + svg);
          }

          if (++plan == 2) {
            console.log('done');
          }
        });

        renderer.saveXML({ format: true }, function(err, xml) {

          if (err) {
            console.log('export bpmn FAIL\n' + JSON.stringify(err));
          } else {
            console.log('export bpmn SUCCESS\n' + xml);
          }

          if (++plan == 2) {
            console.log('done');
          }
        });
      });
    }

    setTimeout(test, 250);
  </script>
</body>
</html>